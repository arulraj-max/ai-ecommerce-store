<!DOCTYPE html>
<html>
<head>
    <title>AI Tech Store</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header>
    <h1>Welcome to the AI Store</h1>
    <p>Currently managing <strong>{{ total }}</strong> premium AI products</p>
</header>

<section class="admin-panel" style="max-width: 600px; margin: 20px auto; padding: 20px; background: #1e293b; border-radius: 12px;">
    <h2>Add New Product</h2>
    <form action="/add-product" method="post" style="display: flex; flex-direction: column; gap: 10px;">
        <input type="text" name="name" placeholder="Product Name" required>
        <input type="number" step="0.01" name="price" placeholder="Price" required>
        <input type="number" name="stock" placeholder="Stock Quantity" required>
        <input type="text" name="image_url" placeholder="Image URL (optional)">
        <button type="submit" style="background: #3b82f6; color: white; padding: 10px; border: none; border-radius: 5px;">
            Add to Inventory
        </button>
    </form>
</section>
<section style="text-align:center; margin:20px;">
    <form method="get" action="/">
        <input 
            type="text" 
            name="search" 
            placeholder="Search AI tools..." 
            value="{{ search if search else '' }}"
            style="padding:8px; width:250px; border-radius:6px;"
        >
        <button type="submit" style="padding:8px 15px;">Search</button>
    </form>
</section>

<div class="product-grid">
    {% if items|length == 0 %}
    <p style="text-align:center; color:#94a3b8;">
        No products found.
    </p>
{% endif %}
    {% for item in items %}
    <div class="product-card">
        <h3>{{ item.name }}</h3>

        {% if item.image_url %}
            <img src="{{ item.image_url }}" width="200" style="margin-bottom:10px; border-radius:8px;">
        {% endif %}

        <p>Price: ${{ item.price }}</p>
        <p>Stock: {{ item.stock }} units</p>

        <div style="display: flex; gap: 5px; margin-top: 10px;">
            <button onclick="openEditModal(
                '{{ item.id }}',
                '{{ item.name|escape }}',
                '{{ item.price }}',
                '{{ item.stock }}',
                '{{ item.image_url|default('')|escape }}'
            )" style="background:#8b5cf6; color:white; border:none; padding:8px; border-radius:5px;">
                Edit
            </button>

            <form action="/delete/{{ item.id }}" method="post">
                <button type="submit" style="background:#ef4444; color:white; border:none; padding:8px; border-radius:5px;">
                    Delete
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>


<!-- EDIT MODAL -->
<div id="editModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); justify-content:center; align-items:center;">
    <div style="background:#1e293b; padding:30px; border:2px solid #3b82f6; border-radius:12px; color:white; width:320px;">
        <h3>Update AI Tool</h3>
        <form id="editForm" method="POST" style="display:flex; flex-direction:column; gap:10px;">
            <input type="text" name="name" id="editName" required>
            <input type="number" step="0.01" name="price" id="editPrice" required>
            <input type="number" name="stock" id="editStock" required>
            <input type="text" name="image_url" id="editImage">

            <button type="submit" style="background:#10b981; color:white; padding:10px; border:none; border-radius:5px;">
                Save Changes
            </button>
            <button type="button" onclick="closeModal()" style="background:transparent; color:#94a3b8; border:none;">
                Cancel
            </button>
        </form>
    </div>
</div>


<script>
function openEditModal(id, name, price, stock, image_url) {
    document.getElementById('editForm').action = '/edit/' + id;
    document.getElementById('editName').value = name;
    document.getElementById('editPrice').value = price;
    document.getElementById('editStock').value = stock;
    document.getElementById('editImage').value = image_url;
    document.getElementById('editModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('editModal').style.display = 'none';
}
</script>

</body>
</html>