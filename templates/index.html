<!DOCTYPE html>
<html>
<head>
    <title>AI Tech Store</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header>
    <h1>Welcome to the AI Store</h1>
    <p>Currently managing <strong>{{ total }}</strong> premium AI products</p>
</header>

<!-- ================= ADMIN PANEL ================= -->
<section class="admin-panel">
    <h2>Add New Product</h2>
    <form action="/add-product" method="post" class="form-vertical">
        <input type="text" name="name" placeholder="Product Name" required>
        <input type="number" step="0.01" name="price" placeholder="Price" required>
        <input type="number" name="stock" placeholder="Stock Quantity" required>
        <input type="text" name="image_url" placeholder="Image URL (optional)">
        <button type="submit" class="btn-primary">Add to Inventory</button>
    </form>
</section>

<!-- ================= SEARCH ================= -->
<section class="search-section">
    <form method="get" action="/">
        <input 
            type="text" 
            name="search" 
            placeholder="Search AI tools..." 
            value="{{ search if search else '' }}"
            class="search-input"
        >
        <button type="submit" class="btn-secondary">Search</button>
    </form>
</section>

<!-- ================= PRODUCT GRID ================= -->
<div class="product-grid">

    {% if items|length == 0 %}
        <p class="empty-state">
            No products found.
        </p>
    {% endif %}

    {% for item in items %}
    <div class="product-card">
        <h3>{{ item.name }}</h3>

        {% if item.image_url %}
            <img src="{{ item.image_url }}" class="product-image">
        {% endif %}

        <p>Price: ${{ item.price }}</p>
        <p>Stock: {{ item.stock }} units</p>

        <div class="card-actions">

            <button 
                class="btn-edit"
                onclick="openEditModal(
                    '{{ item.id }}',
                    '{{ item.name | escape }}',
                    '{{ item.price }}',
                    '{{ item.stock }}',
                    '{{ item.image_url | default("") | escape }}'
                )"
            >
                Edit
            </button>

            <form action="/delete/{{ item.id }}" method="post">
                <button type="submit" class="btn-delete">
                    Delete
                </button>
            </form>

        </div>
    </div>
    {% endfor %}

</div>

<!-- ================= EDIT MODAL ================= -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>Update AI Tool</h3>

        <form id="editForm" method="POST" class="form-vertical">
            <input type="text" name="name" id="editName" required>
            <input type="number" step="0.01" name="price" id="editPrice" required>
            <input type="number" name="stock" id="editStock" required>
            <input type="text" name="image_url" id="editImage">

            <button type="submit" class="btn-save">
                Save Changes
            </button>

            <button type="button" onclick="closeModal()" class="btn-cancel">
                Cancel
            </button>
        </form>
    </div>
</div>

<!-- ================= JAVASCRIPT ================= -->
<script>
function openEditModal(id, name, price, stock, image_url) {
    const form = document.getElementById("editForm");

    form.action = /edit/${id};
    document.getElementById("editName").value = name;
    document.getElementById("editPrice").value = price;
    document.getElementById("editStock").value = stock;
    document.getElementById("editImage").value = image_url;

    document.getElementById("editModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("editModal").style.display = "none";
}
</script>

</body>
</html>